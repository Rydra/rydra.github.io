<!DOCTYPE html>
<html lang="en"><head><title>K3S Learnings - Rydra's Digital Garden</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="K3S Learnings - Rydra's Digital Garden"/><meta property="og:description" content="Introduction Currently I have a server that hosts a bunch of services for my home lab. The infrastructure architecture is pretty simple: The services are deployed in docker containers The services are exposed through Traefik As an exercise I decided to move all those services to kubernetes."/><meta property="og:image" content="https://rydra.github.io/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="Introduction Currently I have a server that hosts a bunch of services for my home lab. The infrastructure architecture is pretty simple: The services are deployed in docker containers The services are exposed through Traefik As an exercise I decided to move all those services to kubernetes."/><meta name="generator" content="Quartz"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Learning/K3S/K3S-Learnings"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../..">ğŸª´ Rydra's Digital Garden</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;Gaming-and-boardgames&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Gaming-and-boardgames/Alone-among-the-stars&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Gaming-and-boardgames/RPG-sessions&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Learning&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Learning/K3S&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Learning/Productivity&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Memes&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Recetas&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Software-Engineering&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Software-Engineering/How-tos&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Software-Engineering/Infographs&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;TIL&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;TIL/concepts&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;TIL/obsidian&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;TIL/Software-Engineering&quot;,&quot;collapsed&quot;:true}]" aria-controls="explorer-content" aria-expanded="false"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Gaming-and-boardgames"><button class="folder-button"><span class="folder-title">Gaming and boardgames</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Gaming-and-boardgames"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Gaming-and-boardgames/Alone-among-the-stars"><button class="folder-button"><span class="folder-title">Alone among the stars</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Gaming-and-boardgames/Alone-among-the-stars"><li><a href="../../Gaming-and-boardgames/Alone-among-the-stars/Planet-Moradan" data-for="Gaming-and-boardgames/Alone-among-the-stars/Planet-Moradan">Planet Moradan</a></li><li><a href="../../Gaming-and-boardgames/Alone-among-the-stars/Planet-Sulfura" data-for="Gaming-and-boardgames/Alone-among-the-stars/Planet-Sulfura">Planet Sulfura</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Gaming-and-boardgames/RPG-sessions"><button class="folder-button"><span class="folder-title">RPG sessions</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Gaming-and-boardgames/RPG-sessions"><li><a href="../../Gaming-and-boardgames/RPG-sessions/Starforged-mindmap" data-for="Gaming-and-boardgames/RPG-sessions/Starforged-mindmap">Starforged mindmap</a></li></ul></div></li><li><a href="../../Gaming-and-boardgames/Useful-oracles-for-TTRPG" data-for="Gaming-and-boardgames/Useful-oracles-for-TTRPG">Useful oracles for TTRPG</a></li><li><a href="../../Gaming-and-boardgames/Videogame-roadmap-for-children" data-for="Gaming-and-boardgames/Videogame-roadmap-for-children">Videogame roadmap for children</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Learning"><button class="folder-button"><span class="folder-title">Learning</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Learning"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Learning/K3S"><button class="folder-button"><span class="folder-title">K3S</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Learning/K3S"><li><a href="../../Learning/K3S/K3S-Learnings" data-for="Learning/K3S/K3S-Learnings">K3S Learnings</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Learning/Productivity"><button class="folder-button"><span class="folder-title">Productivity</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Learning/Productivity"><li><a href="../../Learning/Productivity/CÃ³mo-estudiar-libros-IT-de-manera-eficaz" data-for="Learning/Productivity/CÃ³mo-estudiar-libros-IT-de-manera-eficaz">CÃ³mo estudiar libros IT de manera eficaz</a></li><li><a href="../../Learning/Productivity/CÃ³mo-la-gente-real-procesa-notas" data-for="Learning/Productivity/CÃ³mo-la-gente-real-procesa-notas">CÃ³mo la gente real procesa notas</a></li><li><a href="../../Learning/Productivity/CÃ³mo-tomar-notas-con-la-tÃ©cnica-Cornell" data-for="Learning/Productivity/CÃ³mo-tomar-notas-con-la-tÃ©cnica-Cornell">CÃ³mo tomar notas con la tÃ©cnica Cornell</a></li><li><a href="../../Learning/Productivity/CÃ³mo-tomar-notas-de-manera-eficaz-mientras-estudias-un-libro" data-for="Learning/Productivity/CÃ³mo-tomar-notas-de-manera-eficaz-mientras-estudias-un-libro">CÃ³mo tomar notas de manera eficaz mientras estudias un libro</a></li><li><a href="../../Learning/Productivity/CÃ³mo-hacer-Mindmaps" data-for="Learning/Productivity/CÃ³mo-hacer-Mindmaps">Mindmaps</a></li></ul></div></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Memes"><button class="folder-button"><span class="folder-title">Memes</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Memes"><li><a href="../../Memes/SOLID-principles-with-penguins" data-for="Memes/SOLID-principles-with-penguins">SOLID principles with penguins</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Recetas"><button class="folder-button"><span class="folder-title">Recetas</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Recetas"><li><a href="../../Recetas/Caldo-corto" data-for="Recetas/Caldo-corto">Caldo corto</a></li><li><a href="../../Recetas/Cocer-lentejar" data-for="Recetas/Cocer-lentejar">Cocer lentejar</a></li><li><a href="../../Recetas/Croquetas-de-coliflor-con-bechamel" data-for="Recetas/Croquetas-de-coliflor-con-bechamel">Croquetas de coliflor con bechamel</a></li><li><a href="../../Recetas/Falafel" data-for="Recetas/Falafel">Falafel</a></li><li><a href="../../Recetas/Flan-de-naranja" data-for="Recetas/Flan-de-naranja">Flan de naranja</a></li><li><a href="../../Recetas/Galletas-de-avena" data-for="Recetas/Galletas-de-avena">Galletas de avena</a></li><li><a href="../../Recetas/Galletas-de-avena-y-crema-de-cacahuete" data-for="Recetas/Galletas-de-avena-y-crema-de-cacahuete">Galletas de avena y crema de cacahuete</a></li><li><a href="../../Recetas/Galletas-de-chocolate" data-for="Recetas/Galletas-de-chocolate">Galletas de chocolate</a></li><li><a href="../../Recetas/Hamburguesas-vegetales" data-for="Recetas/Hamburguesas-vegetales">Hamburguesas vegetales</a></li><li><a href="../../Recetas/Hummus" data-for="Recetas/Hummus">Hummus</a></li><li><a href="../../Recetas/Masa-de-pizza" data-for="Recetas/Masa-de-pizza">Masa de pizza</a></li><li><a href="../../Recetas/Merluza-al-horno" data-for="Recetas/Merluza-al-horno">Merluza al horno</a></li><li><a href="../../Recetas/Hamburgusas-de-carne" data-for="Recetas/Hamburgusas-de-carne">Mis propias hamburgusas</a></li><li><a href="../../Recetas/Overnight-Oats" data-for="Recetas/Overnight-Oats">Overnight Oats</a></li><li><a href="../../Recetas/Pollo-a-la-parrilla" data-for="Recetas/Pollo-a-la-parrilla">Pollo a la parrilla</a></li><li><a href="../../Recetas/Pollo-al-horno" data-for="Recetas/Pollo-al-horno">Pollo al horno</a></li><li><a href="../../Recetas/Receta-bizcocho" data-for="Recetas/Receta-bizcocho">Receta bizcocho</a></li><li><a href="../../Recetas/Receta-sencilla-de-col" data-for="Recetas/Receta-sencilla-de-col">Receta sencilla de col</a></li><li><a href="../../Recetas/Restaurante-de-casa" data-for="Recetas/Restaurante-de-casa">Restaurante de casa</a></li><li><a href="../../Recetas/Risotto-de-Manzana" data-for="Recetas/Risotto-de-Manzana">Risotto de Manzana</a></li><li><a href="../../Recetas/Risotto-de-pera" data-for="Recetas/Risotto-de-pera">Risotto de pera</a></li><li><a href="../../Recetas/Rustido-de-pollo" data-for="Recetas/Rustido-de-pollo">Rustido de pollo</a></li><li><a href="../../Recetas/Salsa-de-yogur" data-for="Recetas/Salsa-de-yogur">Salsa de yogur</a></li><li><a href="../../Recetas/Ternera-a-la-plancha" data-for="Recetas/Ternera-a-la-plancha">Ternera a la plancha</a></li><li><a href="../../Recetas/Tiempos-freidora-de-aire" data-for="Recetas/Tiempos-freidora-de-aire">Tiempos freidora de aire</a></li><li><a href="../../Recetas/Vichysoisse" data-for="Recetas/Vichysoisse">Vichysoisse</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Software-Engineering"><button class="folder-button"><span class="folder-title">Software Engineering</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Software-Engineering"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Software-Engineering/How-tos"><button class="folder-button"><span class="folder-title">How-tos</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Software-Engineering/How-tos"><li><a href="../../Software-Engineering/How-tos/Changing-from-Docker-Desktop-to-Docker-Engine" data-for="Software-Engineering/How-tos/Changing-from-Docker-Desktop-to-Docker-Engine">Changing from Docker Desktop to Docker Engine</a></li><li><a href="../../Software-Engineering/How-tos/Software-to-install-in-a-newly-formatted-machine" data-for="Software-Engineering/How-tos/Software-to-install-in-a-newly-formatted-machine">Software to install in a newly formatted machine</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Software-Engineering/Infographs"><button class="folder-button"><span class="folder-title">Infographs</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Software-Engineering/Infographs"><li><a href="../../Software-Engineering/Infographs/Explaining-CI-CD-to-a-kid" data-for="Software-Engineering/Infographs/Explaining-CI-CD-to-a-kid">Explaining CI-CD to a kid</a></li><li><a href="../../Software-Engineering/Infographs/Microservices-best-practices" data-for="Software-Engineering/Infographs/Microservices-best-practices">Microservices best practices</a></li><li><a href="../../Software-Engineering/Infographs/Software-architecture-styles" data-for="Software-Engineering/Infographs/Software-architecture-styles">Software architecture styles</a></li><li><a href="../../Software-Engineering/Infographs/System-Design-Blueprint" data-for="Software-Engineering/Infographs/System-Design-Blueprint">System Design Blueprint</a></li></ul></div></li><li><a href="../../Software-Engineering/Una-arquitectura-web-escalable" data-for="Software-Engineering/Una-arquitectura-web-escalable">Una arquitectura web escalable</a></li><li><a href="../../Software-Engineering/Useful-software-table" data-for="Software-Engineering/Useful-software-table">Useful software table</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="TIL"><button class="folder-button"><span class="folder-title">TIL</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="TIL"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="TIL/concepts"><button class="folder-button"><span class="folder-title">concepts</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="TIL/concepts"><li><a href="../../TIL/concepts/Digital-Garden" data-for="TIL/concepts/Digital-Garden">Digital Garden</a></li><li><a href="../../TIL/concepts/Learn-in-Public" data-for="TIL/concepts/Learn-in-Public">Learn in Public</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="TIL/obsidian"><button class="folder-button"><span class="folder-title">obsidian</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="TIL/obsidian"><li><a href="../../TIL/obsidian/Cornell-Technique" data-for="TIL/obsidian/Cornell-Technique">Cornell Technique</a></li><li><a href="../../TIL/obsidian/Exporting-vault-to-HTML-and-publish-it" data-for="TIL/obsidian/Exporting-vault-to-HTML-and-publish-it">Exporting vault to HTML and publish it</a></li><li><a href="../../TIL/obsidian/Quartz" data-for="TIL/obsidian/Quartz">Quartz</a></li><li><a href="../../TIL/obsidian/Slides-in-Obsidian" data-for="TIL/obsidian/Slides-in-Obsidian">Slides in Obsidian</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="TIL/Software-Engineering"><button class="folder-button"><span class="folder-title">Software Engineering</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="TIL/Software-Engineering"><li><a href="../../TIL/Software-Engineering/Amazon-Cloud-Design-Patterns" data-for="TIL/Software-Engineering/Amazon-Cloud-Design-Patterns">Amazon Cloud Design Patterns</a></li><li><a href="../../TIL/Software-Engineering/Architectural-Metapattens" data-for="TIL/Software-Engineering/Architectural-Metapattens">Architectural Metapatterns</a></li></ul></div></li><li><a href="../../TIL/Autosub-and-Handbrake" data-for="TIL/Autosub-and-Handbrake">Autosub</a></li><li><a href="../../TIL/Zine" data-for="TIL/Zine">Zine</a></li></ul></div></li><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><a href="../../My-CV" data-for="My-CV">CV</a></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> â¯ </p></div><div class="breadcrumb-element"><a href="../../Learning/">Learning</a><p> â¯ </p></div><div class="breadcrumb-element"><a href="../../Learning/K3S/">K3S</a><p> â¯ </p></div><div class="breadcrumb-element"><a href>K3S Learnings</a></div></nav><h1 class="article-title">K3S Learnings</h1><p show-comma="true" class="content-meta"><span>May 15, 2025</span><span>6 min read</span></p><ul class="tags"><li><a href="../../tags/learning" class="internal tag-link">learning</a></li></ul></div></div><article class="popover-hint"><h2 id="introduction">Introduction<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#introduction" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Currently I have a server that hosts a bunch of services for my home lab. The infrastructure architecture is pretty simple:</p>
<ul>
<li>The services are deployed in docker containers</li>
<li>The services are exposed through Traefik</li>
</ul>
<p>As an exercise I decided to move all those services to kubernetes.</p>
<h2 id="the-process">The process<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-process" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>I tried to have everything set with minikube on my local machine. However Iâ€™ve found tons of complexities when trying to run traefik within minikube (ingresses not working, ports not working for some reason, etcâ€¦)</li>
<li>After that, I settled on trying K3S, which is more lightweight, apparently tailored to run on low end machines and home labs (my case), and the best part of it is that it comes bundled with Traefik as reverse proxy</li>
<li>I tried K3D, which is the same as K3S, but running the cluster within a docker container. Itâ€™s not much different that K3S and poses some challenges with port binding and forwarding to expose the services, so I decided to discard that and keep it simple with just K3S.</li>
<li>I managed to deploy a sample service and route it with traefik, getting ready to migrate a bigger service like Komga</li>
<li>Finally I managed to deploy Komga and access it via traefik.</li>
</ol>
<h2 id="cheatsheets">Cheatsheets<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#cheatsheets" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="make-kubectl-work-with-k3s">Make kubectl work with k3s<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#make-kubectl-work-with-k3s" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>When you install k3s and kubectl, you need to run this to bind kubectl to k3s:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/k3s/k3s.yaml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.kube/config</span></span></code></pre></figure>
<h3 id="helm-vs-kustomize">Helm vs Kustomize<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#helm-vs-kustomize" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Reading reddit, the main consensus seems to use Helm as much as possible instead.</p>
<h3 id="useful-make-recipes">Useful Make recipes<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#useful-make-recipes" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="Makefile" data-theme="github-light github-dark"><code data-language="Makefile" data-theme="github-light github-dark" style="display:grid;"><span data-line><span>install:  </span></span>
<span data-line><span>    helm install komga komga  </span></span>
<span data-line><span>  </span></span>
<span data-line><span>upgrade:  </span></span>
<span data-line><span>    helm upgrade komga komga  </span></span>
<span data-line><span>  </span></span>
<span data-line><span>delete:  </span></span>
<span data-line><span>    helm uninstall komga</span></span>
<span data-line> </span>
<span data-line><span>pause:  </span></span>
<span data-line><span>    kubectl scale deployment komga -n komga --replicas=0  </span></span>
<span data-line><span>  </span></span>
<span data-line><span>resume:  </span></span>
<span data-line><span>    kubectl scale deployment komga -n komga --replicas=1</span></span>
<span data-line> </span>
<span data-line><span>expose-grafana:  </span></span>
<span data-line><span>    $(eval POD_NAME=$(shell kubectl --namespace monitoring get svc -l &quot;app.kubernetes.io/name=grafana,app.kubernetes.io/instance=monitoring&quot; -oname))  </span></span>
<span data-line><span>    kubectl port-forward $(POD_NAME) 3001:80 -n monitoring</span></span>
<span data-line> </span>
<span data-line><span>get-dashboard-password:</span></span>
<span data-line><span>	kubectl get secret --namespace monitoring monitoring-grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 -d</span></span></code></pre></figure>
<h3 id="overriding-rancher-configs">Overriding rancher configs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#overriding-rancher-configs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>If you add any files to <code>/var/lib/rancher/k3s/server/manifests/</code> they will be run at startup</p>
<h3 id="adding-prometheus-and-grafana">Adding Prometheus and Grafana<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#adding-prometheus-and-grafana" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="installing-grafana-and-prometheus">Installing grafana and prometheus<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#installing-grafana-and-prometheus" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prometheus-community</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://prometheus-community.github.io/helm-charts</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prometheus-community/kube-prometheus-stack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --create-namespace</span></span></code></pre></figure>
<p>This installs:</p>
<ul>
<li>Prometheus</li>
<li>Grafana</li>
<li>Node Exporter (host metrics)</li>
<li>kube-state-metrics</li>
<li>Alertmanager</li>
</ul>
<p>Using the <code>make expose-grafana</code> recipe you can expose the Grafana dashboard on <code>http://localhost:3001</code>. The user is <code>admin</code>, and the password can be obtained with <code>make get-dashboard-password</code> recipe.</p>
<h3 id="adding-metrics-to-a-service">Adding metrics to a service<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#adding-metrics-to-a-service" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="yaml" data-theme="github-light github-dark"><code data-language="yaml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myapp</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">default</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    prometheus.io/scrape</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    prometheus.io/path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/metrics&quot;</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    prometheus.io/port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8080&quot;</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myapp</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TCP</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span></code></pre></figure>
<h3 id="testing-the-access-to-the-kubernetes-api">Testing the access to the kubernetes API<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#testing-the-access-to-the-kubernetes-api" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="ad-info" data-theme="github-light github-dark"><code data-language="ad-info" data-theme="github-light github-dark" style="display:grid;"><span data-line><span>Reference: https://chatgpt.com/c/682ae7d7-40c8-8012-82a8-fc3e70d49203</span></span></code></pre></figure>
<ul>
<li>The token is available within the pod in <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code></li>
<li>You can access the pod with</li>
</ul>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> komga</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app=komga</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> komga</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&quot;{.items[0].metadata.name}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span></span></code></pre></figure>
<ul>
<li>Test it:</li>
</ul>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light github-dark"><code data-language="bash" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/secrets/kubernetes.io/serviceaccount/token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">APISERVER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://kubernetes.default.svc</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cacert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$TOKEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     $APISERVER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/api/v1/namespaces/komga/pods</span></span></code></pre></figure>
<ul>
<li>If you donâ€™t create a service account, the previous request will fail. Adding a service account to a pod:</li>
</ul>
<h2 id="yaml-definitions-in-a-nutshell">Yaml definitions in a nutshell<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#yaml-definitions-in-a-nutshell" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="ad-abstract" data-theme="github-light github-dark"><code data-language="ad-abstract" data-theme="github-light github-dark" style="display:grid;"><span data-line><span>let me see if I understand, and correct me if I make a mistake on my understanding: A deployment declares the pods that it wants to deploy, and how many replicas of that pod. A pod can have several containers that execute a service. A service definition groups or unites all the pods thanks to the `selector` declaration, and exposes the ports of those pods, essentially load-balancing among them. And an ingress definition exposes the service to a reverse proxy so that it's accessible externally</span></span></code></pre></figure>
<p>David, thatâ€™s an <strong>excellent summary</strong> â€” youâ€™re 95% on point! Just a few tweaks to make it <strong>perfectly accurate</strong>. Hereâ€™s your version with clarifications inline:</p>
<hr/>
<blockquote>
<p>A <strong>Deployment</strong> declares the Pods that it wants to deploy, and how many replicas of that Pod.</p>
</blockquote>
<p>âœ… <strong>Correct.</strong><br/>
The Deployment also watches over those Pods, ensuring theyâ€™re replaced if they crash or change. It uses a <strong>ReplicaSet</strong> under the hood, but you rarely deal with that directly.</p>
<hr/>
<blockquote>
<p>A <strong>Pod</strong> can have several containers that execute a service.</p>
</blockquote>
<p>âœ… Yes, with a small note:<br/>
While a Pod <strong>can</strong> have multiple containers, this is <strong>rare</strong> in practice â€” usually done when containers <strong>need to share the same network and storage space</strong>, like:</p>
<ul>
<li>Main app + sidecar (e.g. logging agent, proxy, init container)</li>
</ul>
<p>Each Pod has:</p>
<ul>
<li>
<p><strong>1 IP</strong></p>
</li>
<li>
<p><strong>Shared volumes</strong></p>
</li>
<li>
<p><strong>Containers in the same namespace</strong></p>
</li>
</ul>
<hr/>
<blockquote>
<p>A <strong>Service</strong> definition groups or unites all the Pods thanks to the <code>selector</code> declaration, and exposes the ports of those Pods, essentially load-balancing among them.</p>
</blockquote>
<p>âœ… <strong>Perfect.</strong></p>
<p>Just to expand:</p>
<ul>
<li>
<p>The Service creates a <strong>stable virtual IP</strong> and DNS name (<code>my-service.default.svc.cluster.local</code>)</p>
</li>
<li>
<p>Internally load balances across matching Pods via kube-proxy (iptables or IPVS rules)</p>
</li>
</ul>
<hr/>
<blockquote>
<p>And an <strong>Ingress</strong> definition exposes the Service to a reverse proxy so that itâ€™s accessible externally.</p>
</blockquote>
<p>âœ… Yes â€” just one important clarification:</p>
<ul>
<li>An <strong>Ingress</strong> is just a <strong>rule set</strong>.</li>
<li>It doesnâ€™t do anything by itself.</li>
<li>You need an <strong>Ingress Controller</strong> (like Traefik, NGINX, Istio, etc.) to interpret those rules and handle the actual HTTP(S) traffic.</li>
</ul>
<p>So:</p>





















<div class="table-container"><table><thead><tr><th>Component</th><th>What it does</th></tr></thead><tbody><tr><td><strong>Service</strong></td><td>Internal load balancer to Pods</td></tr><tr><td><strong>Ingress</strong></td><td>HTTP(S) routing rules</td></tr><tr><td><strong>Ingress Controller</strong></td><td>Reverse proxy implementing those rules</td></tr></tbody></table></div>
<hr/>
<h3 id="-tldr-version-reworded">ğŸ§­ TL;DR version (reworded):<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#-tldr-version-reworded" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>Deployment</strong>: declares how many Pods of a certain spec to run and keeps them alive.</li>
<li><strong>Pod</strong>: runs one or more tightly coupled containers.</li>
<li><strong>Service</strong>: groups matching Pods and load balances traffic to them.</li>
<li><strong>Ingress</strong>: defines HTTP routing to Services â€” but needs an Ingress Controller to work.</li>
</ul>
<hr/>
<p>Hereâ€™s a conceptual diagram of how <strong>Deployments, Pods, Services, and Ingress</strong> work together in a Kubernetes cluster:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                Ingress                                     â”‚
â”‚                         (e.g. route: /api â†’ service/api)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Ingress Controller      â”‚
                          â”‚ (e.g. Traefik, NGINX)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚    Service: api    â”‚â—€â”€â”€â”€â”€â”
                           â”‚ selector: app=api  â”‚     â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                 â”‚   â–²                â”‚
     Load balances between       â”‚   â”‚                â”‚
        matching Pods            â–¼   â”‚                â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                         â”‚   Pod (1)    â”‚â—€â”€â”€â”€â”€â”€â”      â”‚
                         â”‚ app: api     â”‚      â”‚      â”‚
                         â”‚ container(s) â”‚      â”‚      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
                         â”‚   Pod (2)    â”‚â—€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ app: api     â”‚      â”‚
                         â”‚ container(s) â”‚      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                         â”‚   Pod (3)    â”‚â—€â”€â”€â”€â”€â”€â”˜
                         â”‚ app: api     â”‚
                         â”‚ container(s) â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â–²
                              â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚      Deployment: api       â”‚
               â”‚ replicas: 3, template w/   â”‚
               â”‚   labels: app: api         â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 id="-key-points">ğŸ” Key Points:<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#-key-points" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>Deployment</strong> creates <strong>ReplicaSet</strong>, which creates <strong>Pods</strong> with matching labels (<code>app=api</code>).</li>
<li><strong>Service</strong> selects Pods using a <strong>label selector</strong> and load balances traffic.</li>
<li><strong>Ingress Controller</strong> reads the <strong>Ingress rules</strong> and sends HTTP traffic to the appropriate <strong>Service</strong>.</li>
<li><strong>Ingress</strong> is just configuration â€” not the proxy itself.</li>
</ul>
<hr/>
<p>Let me know if youâ€™d like this diagram as a downloadable image or tailored to your actual <code>k3s + Traefik</code> setup.</p>
<h2 id="next-steps-to-learn">Next steps to learn<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#next-steps-to-learn" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled/> <strong>Persistent storage</strong> with <code>local-path-provisioner</code> or NFS.</li>
<li class="task-list-item"><input type="checkbox" disabled/> <strong>Secrets and ConfigMaps</strong> for app configuration.</li>
<li class="task-list-item"><input type="checkbox" disabled/> <strong>Helm charts</strong> for simplifying complex deployments (like Komga, Jellyfin, etc).</li>
<li class="task-list-item"><input type="checkbox" disabled/> <strong>Monitoring</strong> (e.g., Prometheus + Grafana).</li>
<li class="task-list-item"><input type="checkbox" disabled/> <strong>Certificates with Letâ€™s Encrypt</strong> via Traefik.</li>
<li class="task-list-item"><input type="checkbox" disabled/> <strong>Automated backups</strong> for manifests and PVs.</li>
</ul></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class aria-controls="toc-content" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content" class><ul class="overflow"><li class="depth-0"><a href="#introduction" data-for="introduction">Introduction</a></li><li class="depth-0"><a href="#the-process" data-for="the-process">The process</a></li><li class="depth-0"><a href="#cheatsheets" data-for="cheatsheets">Cheatsheets</a></li><li class="depth-1"><a href="#make-kubectl-work-with-k3s" data-for="make-kubectl-work-with-k3s">Make kubectl work with k3s</a></li><li class="depth-1"><a href="#helm-vs-kustomize" data-for="helm-vs-kustomize">Helm vs Kustomize</a></li><li class="depth-1"><a href="#useful-make-recipes" data-for="useful-make-recipes">Useful Make recipes</a></li><li class="depth-1"><a href="#overriding-rancher-configs" data-for="overriding-rancher-configs">Overriding rancher configs</a></li><li class="depth-1"><a href="#adding-prometheus-and-grafana" data-for="adding-prometheus-and-grafana">Adding Prometheus and Grafana</a></li><li class="depth-1"><a href="#adding-metrics-to-a-service" data-for="adding-metrics-to-a-service">Adding metrics to a service</a></li><li class="depth-1"><a href="#testing-the-access-to-the-kubernetes-api" data-for="testing-the-access-to-the-kubernetes-api">Testing the access to the kubernetes API</a></li><li class="depth-0"><a href="#yaml-definitions-in-a-nutshell" data-for="yaml-definitions-in-a-nutshell">Yaml definitions in a nutshell</a></li><li class="depth-1"><a href="#-tldr-version-reworded" data-for="-tldr-version-reworded">ğŸ§­ TL;DR version (reworded):</a></li><li class="depth-1"><a href="#-key-points" data-for="-key-points">ğŸ” Key Points:</a></li><li class="depth-0"><a href="#next-steps-to-learn" data-for="next-steps-to-learn">Next steps to learn</a></li></ul></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> Â© 2025</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../../postscript.js" type="module"></script></html>